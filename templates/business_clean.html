<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Control Center - {{ hotel_name }}</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container">
        <h1>ğŸ›ï¸ CONTROL CENTER</h1>
        
        <nav class="nav">
            <button onclick="showSection('rooms')" class="nav-btn active" id="rooms-btn">ğŸ¨ ROOM STATUS</button>
            <button onclick="showSection('bookings')" class="nav-btn" id="bookings-btn">ğŸ“‹ BOOKINGS</button>
            <button onclick="showSection('room-management')" class="nav-btn" id="room-management-btn">ğŸ›Œ ROOM MANAGEMENT</button>
            <button onclick="showSection('photos')" class="nav-btn" id="photos-btn">ğŸ“¸ PHOTOS</button>
            <button onclick="logout()" class="nav-btn" style="margin-left: auto; background: linear-gradient(135deg, #ff4757, #ff3742); color: white;">ğŸšª DISCONNECT</button>
        </nav>

        <div id="rooms" class="section-content">
            <div class="card">
                <h2>ğŸ¨ ROOM STATUS</h2>
                <div id="rooms-grid"></div>
            </div>
        </div>

        <div id="bookings" class="section-content" style="display: none;">
            <div class="card">
                <h2>ğŸ“‹ BOOKINGS</h2>
                <div id="bookings-list"></div>
            </div>
        </div>

        <div id="room-management" class="section-content" style="display: none;">
            <div class="card">
                <h2>ğŸ›Œ ROOM MANAGEMENT</h2>
                <div id="room-types-list"></div>
            </div>
        </div>

        <div id="photos" class="section-content" style="display: none;">
            <div class="card">
                <h2>ğŸ“¸ PHOTOS</h2>
                <input type="file" id="header-image-file" accept="image/*">
                <button onclick="uploadHeaderImage()">UPLOAD HEADER</button>
            </div>
        </div>
    </div>

    <script>
        const hotelSubdomain = '{{ hotel_subdomain if hotel_subdomain else "" }}';
        
        function showSection(sectionId) {
            document.querySelectorAll('.section-content').forEach(section => {
                section.style.display = 'none';
            });
            
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.getElementById(sectionId).style.display = 'block';
            document.getElementById(sectionId + '-btn').classList.add('active');
            
            if (sectionId === 'rooms') {
                loadRooms();
            } else if (sectionId === 'bookings') {
                loadBookings();
            } else if (sectionId === 'room-management') {
                loadRoomTypes();
            }
        }

        async function loadRooms() {
            const url = hotelSubdomain ? `/business/rooms?hotel_subdomain=${hotelSubdomain}` : '/business/rooms';
            try {
                const response = await fetch(url);
                const rooms = await response.json();
                document.getElementById('rooms-grid').innerHTML = rooms.map(room => 
                    `<div>Room ${room.room_number} - ${room.status}</div>`
                ).join('');
            } catch (error) {
                document.getElementById('rooms-grid').innerHTML = 'Error loading rooms';
            }
        }

        async function loadBookings() {
            const url = hotelSubdomain ? `/business/bookings?hotel_subdomain=${hotelSubdomain}` : '/business/bookings';
            try {
                const response = await fetch(url);
                const bookings = await response.json();
                document.getElementById('bookings-list').innerHTML = bookings.map(booking => 
                    `<div>${booking.guest_name} - Room ${booking.room_number}</div>`
                ).join('');
            } catch (error) {
                document.getElementById('bookings-list').innerHTML = 'Error loading bookings';
            }
        }

        async function loadRoomTypes() {
            const url = hotelSubdomain ? `/business/room-types?hotel_subdomain=${hotelSubdomain}` : '/business/room-types';
            try {
                const response = await fetch(url);
                const roomTypes = await response.json();
                document.getElementById('room-types-list').innerHTML = roomTypes.map(type => 
                    `<div>${type.room_type} - $${type.price_per_night}/night</div>`
                ).join('');
            } catch (error) {
                document.getElementById('room-types-list').innerHTML = 'Error loading room types';
            }
        }

        async function uploadHeaderImage() {
            const file = document.getElementById('header-image-file').files[0];
            if (!file) return;
            
            const formData = new FormData();
            formData.append('file', file);
            formData.append('upload_preset', 'hotel_images');
            
            try {
                const response = await fetch('https://api.cloudinary.com/v1_1/dzowvr6xu/image/upload', {
                    method: 'POST',
                    body: formData
                });
                const data = await response.json();
                
                if (data.secure_url) {
                    const endpoint = hotelSubdomain ? `/business/update-header?hotel_subdomain=${hotelSubdomain}` : '/business/update-header';
                    await fetch(endpoint, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ header_image_url: data.secure_url })
                    });
                    alert('Header uploaded successfully!');
                }
            } catch (error) {
                alert('Upload failed');
            }
        }

        function logout() {
            window.location.href = '/business/login';
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadRooms();
        });
    </script>
</body>
</html>